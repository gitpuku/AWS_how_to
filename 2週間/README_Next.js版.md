# AWS 14æ—¥é–“ãƒãƒ£ãƒ¬ãƒ³ã‚¸ - Next.js + Docker ç‰ˆ æ‰‹é †æ›¸

## ðŸ“š æ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚»ãƒƒãƒˆã¯ã€Udemy ã®ã€ŒAWS 14æ—¥é–“ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã€ã‚³ãƒ¼ã‚¹ã® PHP + Apache ç’°å¢ƒã‚’ **Next.js 14 (App Router) + TypeScript + Tailwind CSS + Docker** ã«ç½®ãæ›ãˆãŸæ‰‹é †æ›¸ã§ã™ã€‚

## ðŸŽ¯ å¯¾è±¡è€…

- **PHP ãŒã‚ã‹ã‚‰ãªã„ãŒã€Next.js ã¯ä½¿ãˆã‚‹æ–¹**
- **Docker ã«æ…£ã‚Œã¦ã„ã‚‹æ–¹**
- **AWS ã®å­¦ç¿’ã«é›†ä¸­ã—ãŸã„æ–¹**
- **ãƒ¢ãƒ€ãƒ³ãª JavaScript ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ AWS ã‚’å­¦ã³ãŸã„æ–¹**

## ðŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸€è¦§

### âœ… ä½œæˆæ¸ˆã¿ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

| Day | ã‚¿ã‚¤ãƒˆãƒ« | ä¸»ãªå†…å®¹ |
|-----|---------|---------|
| **Day03** | [VPCç’°å¢ƒæ§‹ç¯‰(å‰ç·¨)](./Day03_Next.jsç‰ˆ_VPCç’°å¢ƒæ§‹ç¯‰(å‰ç·¨).md) | VPCã€ã‚µãƒ–ãƒãƒƒãƒˆã€Next.js ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã€PM2 |
| **Day04** | [VPCç’°å¢ƒæ§‹ç¯‰(å¾Œç·¨)](./Day04_Next.jsç‰ˆ_VPCç’°å¢ƒæ§‹ç¯‰(å¾Œç·¨).md) | ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆã€MySQL æŽ¥ç¶šã€mysql2 |
| **Day05** | [RDS ãƒžãƒãƒ¼ã‚¸ãƒ‰DB](./Day05_Next.jsç‰ˆ_RDSãƒžãƒãƒ¼ã‚¸ãƒ‰DB.md) | RDS ç§»è¡Œã€ç’°å¢ƒå¤‰æ•°ç®¡ç†ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— |
| **Day06** | [ELB è² è·åˆ†æ•£](./Day06_Next.jsç‰ˆ_ELBè² è·åˆ†æ•£.md) | ALBã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã€è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ |
| **Day13** | [CI/CD æ§‹ç¯‰](./Day13_Next.jsç‰ˆ_CICD.md) | CodeBuildã€CodeDeployã€CodePipeline |

### ðŸ“ å…ƒã® PHP ç‰ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆå‚è€ƒï¼‰

ãã®ä»–ã® Day (Day01, Day02, Day07ã€œDay12, Day14) ã¯ã€å…ƒã® PHP ç‰ˆæ‰‹é †æ›¸ã‚’ãã®ã¾ã¾ä½¿ç”¨ã§ãã¾ã™ã€‚AWS ã‚µãƒ¼ãƒ“ã‚¹ã®å­¦ç¿’ãŒãƒ¡ã‚¤ãƒ³ã®ãŸã‚ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨€èªžã®å½±éŸ¿ã‚’å—ã‘ã¾ã›ã‚“ã€‚

## ðŸ”§ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- **Next.js 14** (App Router)
- **TypeScript**
- **Tailwind CSS**
- **React 18**

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- **MySQL 8.4**
- **mysql2** (Node.js MySQL ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ)
- **Amazon RDS**

### ã‚¤ãƒ³ãƒ•ãƒ©ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤
- **Docker** & **Docker Compose**
- **Amazon EC2** (Amazon Linux 2023)
- **Amazon VPC**
- **Application Load Balancer**
- **AWS CodePipeline / CodeBuild / CodeDeploy**

## ðŸ“‹ PHP ç‰ˆã¨ã®ä¸»ãªé•ã„

| é …ç›® | PHP ç‰ˆ | Next.js + Docker ç‰ˆ |
|------|--------|---------------------|
| **Web ã‚µãƒ¼ãƒãƒ¼** | Apache | Next.js (ã‚³ãƒ³ãƒ†ãƒŠ) |
| **è¨€èªž** | PHP | TypeScript |
| **ãƒãƒ¼ãƒˆ** | 80 | 3000 |
| **ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†** | systemd (httpd) | Docker Compose |
| **DB ãƒ‰ãƒ©ã‚¤ãƒ** | mysqli | mysql2 |
| **ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°** | ç´ ã® CSS | Tailwind CSS |
| **ãƒ“ãƒ«ãƒ‰** | ä¸è¦ | `docker compose build` å¿…è¦ |
| **ç’°å¢ƒå¤‰æ•°** | ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ | .env + docker-compose.yml |

## ðŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. ç’°å¢ƒæº–å‚™ï¼ˆDay03ï¼‰

```bash
# Docker ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo dnf install docker -y
sudo systemctl start docker
sudo systemctl enable docker
sudo usermod -aG docker ec2-user

# Docker Compose ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo mkdir -p /usr/local/lib/docker/cli-plugins
sudo curl -SL https://github.com/docker/compose/releases/latest/download/docker-compose-linux-x86_64 -o /usr/local/lib/docker/cli-plugins/docker-compose
sudo chmod +x /usr/local/lib/docker/cli-plugins/docker-compose

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ
mkdir -p ~/simple-blog
cd ~/simple-blog
```

### 2. Next.js ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
cd ~/simple-blog

# Dockerfile ã¨ docker-compose.yml ã‚’ä½œæˆï¼ˆDay03 ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‚ç…§ï¼‰

# Docker ã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦èµ·å‹•
docker compose up -d --build

# ãƒ­ã‚°ç¢ºèª
docker compose logs -f
```

### 3. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

```bash
# .env ã‚’ä½œæˆ
cat > .env << 'EOF'
DB_HOST=your-db-host
DB_USER=simpleblog_user
DB_PASSWORD=User!1234
DB_NAME=simpleblog_db
INSTANCE_ID=web-1a
EOF

# Docker ã‚³ãƒ³ãƒ†ãƒŠã‚’å†èµ·å‹•
docker compose down
docker compose up -d
```

## ðŸ“‚ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
simple-blog/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ layout.tsx          # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ page.tsx            # ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ globals.css         # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ posts/
â”‚           â””â”€â”€ route.ts    # API ãƒ«ãƒ¼ãƒˆï¼ˆæŠ•ç¨¿å–å¾—ãƒ»ä½œæˆï¼‰
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ db.ts              # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æŽ¥ç¶š
â”‚   â””â”€â”€ types.ts           # åž‹å®šç¾©
â”œâ”€â”€ scripts/               # ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆDay13ï¼‰
â”‚   â”œâ”€â”€ application_start.sh
â”‚   â”œâ”€â”€ application_stop.sh
â”‚   â”œâ”€â”€ before_install.sh
â”‚   â””â”€â”€ after_install.sh
â”œâ”€â”€ package.json
â”œâ”€â”€ next.config.ts
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ tailwind.config.ts
â”œâ”€â”€ buildspec.yml          # CodeBuild è¨­å®š
â”œâ”€â”€ appspec.yml            # CodeDeploy è¨­å®š
â””â”€â”€ .env.local            # ç’°å¢ƒå¤‰æ•°ï¼ˆGitç®¡ç†å¤–ï¼‰
```

## ðŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—è¨­å®š

### Web ã‚µãƒ¼ãƒãƒ¼ç”¨ (web-sg)

| ã‚¿ã‚¤ãƒ— | ãƒãƒ¼ãƒˆ | ã‚½ãƒ¼ã‚¹ | èª¬æ˜Ž |
|--------|--------|--------|------|
| SSH | 22 | 0.0.0.0/0 | SSH ã‚¢ã‚¯ã‚»ã‚¹ |
| ã‚«ã‚¹ã‚¿ãƒ  TCP | 3000 | alb-sg | Next.js (ALB çµŒç”±ã®ã¿) |

### ALB ç”¨ (alb-sg)

| ã‚¿ã‚¤ãƒ— | ãƒãƒ¼ãƒˆ | ã‚½ãƒ¼ã‚¹ | èª¬æ˜Ž |
|--------|--------|--------|------|
| HTTP | 80 | 0.0.0.0/0 | HTTP ã‚¢ã‚¯ã‚»ã‚¹ |

### DB ç”¨ (db-sg)

| ã‚¿ã‚¤ãƒ— | ãƒãƒ¼ãƒˆ | ã‚½ãƒ¼ã‚¹ | èª¬æ˜Ž |
|--------|--------|--------|------|
| MySQL | 3306 | web-sg | Web ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ |

## ðŸ’¡ ã‚ˆãã‚ã‚‹è³ªå•

### Q: PHP ç‰ˆã¨ Next.js ç‰ˆã®é›£æ˜“åº¦ã¯ï¼Ÿ

**A:** Next.js ç‰ˆã®æ–¹ãŒã‚„ã‚„è¤‡é›‘ã§ã™ã€‚ç†ç”±ï¼š
- ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ãŒå¿…è¦
- Node.js / npm ã®çŸ¥è­˜ãŒå¿…è¦
- ç’°å¢ƒå¤‰æ•°ã®ç®¡ç†ãŒé‡è¦
- PM2 ã«ã‚ˆã‚‹ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†

ãŸã ã—ã€Next.js ã«æ…£ã‚Œã¦ã„ã‚‹æ–¹ã«ã¨ã£ã¦ã¯ã€PHP ã‚ˆã‚Šã‚‚ç†è§£ã—ã‚„ã™ã„ã¯ãšã§ã™ã€‚

### Q: ã©ã® Day ã‹ã‚‰ Next.js ç‰ˆã‚’ä½¿ã†ã¹ãï¼Ÿ

**A:** Day03 ã‹ã‚‰ä½¿ç”¨é–‹å§‹ãŒãŠã™ã™ã‚ã§ã™ã€‚

- **Day01, Day02**: PHP/Next.js ã«ä¾å­˜ã—ãªã„ãŸã‚ã€å…ƒã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½¿ç”¨
- **Day03ã€œDay06**: Next.js ç‰ˆã‚’ä½¿ç”¨
- **Day07ã€œDay12**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã«é–¢ä¿‚ãªã„ãŸã‚ã€å…ƒã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½¿ç”¨
- **Day13**: Next.js ç‰ˆã‚’ä½¿ç”¨ï¼ˆCI/CDï¼‰
- **Day14**: CloudFormation ã¯å…ƒã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½¿ç”¨ï¼ˆå¿…è¦ã«å¿œã˜ã¦èª¿æ•´ï¼‰

### Q: æ–™é‡‘ã¯ PHP ç‰ˆã¨å¤‰ã‚ã‚‹ï¼Ÿ

**A:** ã»ã¼åŒã˜ã§ã™ã€‚ä¸»ãªé•ã„ï¼š
- **åŒã˜**: EC2 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚µã‚¤ã‚º (t2.micro)
- **åŒã˜**: RDSã€ALBã€S3 ãªã©ã®æ–™é‡‘
- **ã‚ãšã‹ã«å¢—**: CodeBuild ã®å®Ÿè¡Œæ™‚é–“ï¼ˆãƒ“ãƒ«ãƒ‰ãŒå¿…è¦ãªãŸã‚ï¼‰

### Q: æœ¬ç•ªç’°å¢ƒã§ã‚‚ä½¿ãˆã‚‹ï¼Ÿ

**A:** ã¯ã„ã€ãŸã ã—ä»¥ä¸‹ã‚’æŽ¨å¥¨ï¼š
- **ç’°å¢ƒå¤‰æ•°**: AWS Secrets Manager ã‚„ Parameter Store ã‚’ä½¿ç”¨
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—**: ã‚ˆã‚ŠåŽ³å¯†ãªåˆ¶é™
- **ãƒ­ã‚°ç®¡ç†**: CloudWatch Logs ã¸ã® PM2 ãƒ­ã‚°è»¢é€
- **ç›£è¦–**: CloudWatch ã‚¢ãƒ©ãƒ¼ãƒ ã®è¨­å®š
- **HTTPS**: ALB ã§ SSL/TLS è¨¼æ˜Žæ›¸ã‚’è¨­å®š

## ðŸ› ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Docker ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ãªã„

```bash
# ãƒ­ã‚°ã‚’ç¢ºèª
docker compose logs

# æ‰‹å‹•ã§èµ·å‹•ãƒ†ã‚¹ãƒˆ
cd ~/simple-blog
npm run start

# ãƒãƒ¼ãƒˆãŒä½¿ç”¨ä¸­ã‹ã©ã†ã‹ç¢ºèª
sudo netstat -tulpn | grep 3000
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æŽ¥ç¶šã§ããªã„

```bash
# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ç¢ºèª
# MySQL ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§æŽ¥ç¶šãƒ†ã‚¹ãƒˆ
mysql -h [DB_HOST] -u simpleblog_user -p

# .env ã®å†…å®¹ã‚’ç¢ºèª
cat ~/simple-blog/.env
```

### ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹

```bash
# ã‚³ãƒ³ãƒ†ãƒŠã‚’å†æ§‹ç¯‰
docker compose down
docker compose build --no-cache
docker compose up -d
```

## ðŸ“ž ã‚µãƒãƒ¼ãƒˆ

- **å…ƒã®ã‚³ãƒ¼ã‚¹**: Udemyã€ŒAWS 14æ—¥é–“ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã€
- **Next.js å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: https://nextjs.org/docs
- **AWS ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: https://docs.aws.amazon.com/

## ðŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯å­¦ç¿’ç›®çš„ã§ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚å…ƒã®ã‚³ãƒ¼ã‚¹ã®è£œå®Œè³‡æ–™ã¨ã—ã¦ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

## ðŸ™ è¬è¾ž

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€Udemy ã®ã€ŒAWS 14æ—¥é–“ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã€ã‚³ãƒ¼ã‚¹ã‚’ãƒ™ãƒ¼ã‚¹ã«ä½œæˆã—ã¾ã—ãŸã€‚å…ƒã®ã‚³ãƒ¼ã‚¹ä½œæˆè€…ã«æ„Ÿè¬ã„ãŸã—ã¾ã™ã€‚

---

**Happy Learning with Next.js on AWS! ðŸš€**
