<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CIDRè¡¨è¨˜å¤‰æ›ãƒ„ãƒ¼ãƒ«</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        padding: 30px;
      }

      h1 {
        text-align: center;
        color: #333;
        margin-bottom: 30px;
        font-size: 28px;
      }

      .input-section {
        margin-bottom: 30px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: #555;
      }

      input {
        width: 100%;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s;
      }

      input:focus {
        outline: none;
        border-color: #667eea;
      }

      .result-section {
        margin-top: 30px;
      }

      .result-box {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
      }

      .result-title {
        font-weight: bold;
        color: #667eea;
        margin-bottom: 15px;
        font-size: 18px;
        border-bottom: 2px solid #667eea;
        padding-bottom: 5px;
      }

      .ip-display {
        font-family: "Courier New", monospace;
        font-size: 16px;
        margin: 10px 0;
        padding: 10px;
        background: white;
        border-radius: 5px;
      }

      .binary-display {
        font-family: "Courier New", monospace;
        font-size: 14px;
        line-height: 1.8;
        background: white;
        padding: 15px;
        border-radius: 5px;
        overflow-x: auto;
      }

      .network-part {
        color: #e74c3c;
        font-weight: bold;
        background: #ffe6e6;
        padding: 2px 4px;
        border-radius: 3px;
      }

      .host-part {
        color: #3498db;
        font-weight: bold;
        background: #e6f3ff;
        padding: 2px 4px;
        border-radius: 3px;
      }

      .octet-separator {
        color: #999;
        margin: 0 5px;
      }

      .info-row {
        display: flex;
        justify-content: space-between;
        margin: 8px 0;
        padding: 8px;
        background: white;
        border-radius: 5px;
      }

      .info-label {
        font-weight: bold;
        color: #666;
      }

      .info-value {
        font-family: "Courier New", monospace;
        color: #333;
      }

      .legend {
        display: flex;
        gap: 20px;
        margin-top: 15px;
        padding: 10px;
        background: white;
        border-radius: 5px;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .legend-color {
        width: 20px;
        height: 20px;
        border-radius: 3px;
      }

      .legend-network {
        background: #ffe6e6;
        border: 2px solid #e74c3c;
      }

      .legend-host {
        background: #e6f3ff;
        border: 2px solid #3498db;
      }

      .error {
        color: #e74c3c;
        background: #ffe6e6;
        padding: 10px;
        border-radius: 5px;
        margin-top: 10px;
      }

      @media (max-width: 600px) {
        .container {
          padding: 20px;
        }

        h1 {
          font-size: 24px;
        }

        .legend {
          flex-direction: column;
          gap: 10px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸŒ CIDRè¡¨è¨˜å¤‰æ›ãƒ„ãƒ¼ãƒ«</h1>

      <div class="input-section">
        <label for="cidrInput"
          >CIDRè¡¨è¨˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (ä¾‹: 192.168.1.0/24)</label
        >
        <input
          type="text"
          id="cidrInput"
          placeholder="192.168.1.0/24"
          value="192.168.1.0/24"
        />
      </div>

      <div class="legend">
        <div class="legend-item">
          <div class="legend-color legend-network"></div>
          <span>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éƒ¨</span>
        </div>
        <div class="legend-item">
          <div class="legend-color legend-host"></div>
          <span>ãƒ›ã‚¹ãƒˆéƒ¨</span>
        </div>
      </div>

      <div class="result-section" id="resultSection"></div>
    </div>

    <script>
      // IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’2é€²æ•°ã«å¤‰æ›
      function ipToBinary(ip) {
        return ip.split(".").map((octet) => {
          return parseInt(octet).toString(2).padStart(8, "0");
        });
      }

      // 2é€²æ•°ã‚’IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¤‰æ›
      function binaryToIp(binary) {
        const octets = [];
        for (let i = 0; i < 32; i += 8) {
          octets.push(parseInt(binary.substr(i, 8), 2));
        }
        return octets.join(".");
      }

      // ã‚µãƒ–ãƒãƒƒãƒˆãƒã‚¹ã‚¯ã‚’ç”Ÿæˆ
      function cidrToSubnetMask(cidr) {
        const mask = "1".repeat(cidr) + "0".repeat(32 - cidr);
        return binaryToIp(mask);
      }

      // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨ˆç®—
      function calculateNetworkAddress(ip, cidr) {
        const ipBinary = ipToBinary(ip).join("");
        const networkBinary = ipBinary.substr(0, cidr) + "0".repeat(32 - cidr);
        return binaryToIp(networkBinary);
      }

      // ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨ˆç®—
      function calculateBroadcastAddress(ip, cidr) {
        const ipBinary = ipToBinary(ip).join("");
        const broadcastBinary =
          ipBinary.substr(0, cidr) + "1".repeat(32 - cidr);
        return binaryToIp(broadcastBinary);
      }

      // åˆ©ç”¨å¯èƒ½ãªãƒ›ã‚¹ãƒˆæ•°ã‚’è¨ˆç®—
      function calculateHostCount(cidr) {
        const hostBits = 32 - cidr;
        return Math.pow(2, hostBits) - 2; // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’é™¤ã
      }

      // 2é€²æ•°è¡¨ç¤ºã‚’ç”Ÿæˆï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éƒ¨ã¨ãƒ›ã‚¹ãƒˆéƒ¨ã‚’è‰²åˆ†ã‘ï¼‰
      function generateBinaryDisplay(ip, cidr) {
        const binary = ipToBinary(ip);
        let html = "";
        let bitCount = 0;

        binary.forEach((octet, index) => {
          for (let i = 0; i < 8; i++) {
            const bit = octet[i];
            if (bitCount < cidr) {
              html += `<span class="network-part">${bit}</span>`;
            } else {
              html += `<span class="host-part">${bit}</span>`;
            }
            bitCount++;
          }
          if (index < 3) {
            html += '<span class="octet-separator">.</span>';
          }
        });

        return html;
      }

      // 10é€²æ•°è¡¨ç¤ºã‚’ç”Ÿæˆï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éƒ¨ã¨ãƒ›ã‚¹ãƒˆéƒ¨ã‚’è‰²åˆ†ã‘ï¼‰
      function generateDecimalDisplay(ip, cidr) {
        const octets = ip.split(".");
        let html = "";
        let bitCount = 0;

        octets.forEach((octet, index) => {
          const octetBits = 8;
          const bitsInThisOctet = Math.min(cidr - bitCount, octetBits);

          if (bitCount >= cidr) {
            // ã™ã¹ã¦ãƒ›ã‚¹ãƒˆéƒ¨
            html += `<span class="host-part">${octet}</span>`;
          } else if (bitsInThisOctet >= octetBits) {
            // ã™ã¹ã¦ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éƒ¨
            html += `<span class="network-part">${octet}</span>`;
          } else if (bitsInThisOctet > 0) {
            // æ··åœ¨ï¼ˆå¢ƒç•Œã‚ªã‚¯ãƒ†ãƒƒãƒˆï¼‰
            html += `<span style="background: linear-gradient(90deg, #ffe6e6 50%, #e6f3ff 50%); padding: 2px 4px; border-radius: 3px; font-weight: bold;">${octet}</span>`;
          } else {
            html += `<span class="host-part">${octet}</span>`;
          }

          bitCount += octetBits;

          if (index < 3) {
            html += '<span class="octet-separator">.</span>';
          }
        });

        return html;
      }

      // CIDRè¡¨è¨˜ã‚’ãƒ‘ãƒ¼ã‚¹
      function parseCIDR(cidrNotation) {
        const match = cidrNotation.match(
          /^(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})\/(\d{1,2})$/
        );
        if (!match) {
          throw new Error("ç„¡åŠ¹ãªCIDRè¡¨è¨˜ã§ã™ã€‚æ­£ã—ã„å½¢å¼: xxx.xxx.xxx.xxx/xx");
        }

        const ip = match[1];
        const cidr = parseInt(match[2]);

        // IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®å„ã‚ªã‚¯ãƒ†ãƒƒãƒˆã‚’æ¤œè¨¼
        const octets = ip.split(".");
        for (let octet of octets) {
          const num = parseInt(octet);
          if (num < 0 || num > 255) {
            throw new Error(
              "IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®å„ã‚ªã‚¯ãƒ†ãƒƒãƒˆã¯0-255ã®ç¯„å›²ã§æŒ‡å®šã—ã¦ãã ã•ã„"
            );
          }
        }

        // CIDRã®ç¯„å›²ã‚’æ¤œè¨¼
        if (cidr < 0 || cidr > 32) {
          throw new Error("ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹é•·ã¯0-32ã®ç¯„å›²ã§æŒ‡å®šã—ã¦ãã ã•ã„");
        }

        return { ip, cidr };
      }

      // çµæœã‚’è¡¨ç¤º
      function displayResults(cidrNotation) {
        const resultSection = document.getElementById("resultSection");

        try {
          const { ip, cidr } = parseCIDR(cidrNotation);

          const subnetMask = cidrToSubnetMask(cidr);
          const networkAddress = calculateNetworkAddress(ip, cidr);
          const broadcastAddress = calculateBroadcastAddress(ip, cidr);
          const hostCount = calculateHostCount(cidr);
          const firstHost = calculateFirstHost(networkAddress);
          const lastHost = calculateLastHost(broadcastAddress);

          resultSection.innerHTML = `
                    <div class="result-box">
                        <div class="result-title">ğŸ“Š åŸºæœ¬æƒ…å ±</div>
                        <div class="info-row">
                            <span class="info-label">å…¥åŠ›ã•ã‚ŒãŸIP:</span>
                            <span class="info-value">${ip}/${cidr}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ã‚µãƒ–ãƒãƒƒãƒˆãƒã‚¹ã‚¯:</span>
                            <span class="info-value">${subnetMask}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹:</span>
                            <span class="info-value">${networkAddress}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹:</span>
                            <span class="info-value">${broadcastAddress}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">åˆ©ç”¨å¯èƒ½ãªãƒ›ã‚¹ãƒˆæ•°:</span>
                            <span class="info-value">${hostCount.toLocaleString()} å°</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">åˆ©ç”¨å¯èƒ½ç¯„å›²:</span>
                            <span class="info-value">${firstHost} ã€œ ${lastHost}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">æœ€åˆã®ãƒ›ã‚¹ãƒˆ:</span>
                            <span class="info-value">${firstHost}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">æœ€å¾Œã®ãƒ›ã‚¹ãƒˆ:</span>
                            <span class="info-value">${lastHost}</span>
                        </div>
                    </div>

                    <div class="result-box">
                        <div class="result-title">ğŸ”¢ 10é€²æ•°è¡¨ç¤ºï¼ˆè‰²åˆ†ã‘ï¼‰</div>
                        <div class="ip-display">
                            å…¥åŠ›IP: ${generateDecimalDisplay(ip, cidr)}
                        </div>
                        <div class="ip-display">
                            ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹: ${generateDecimalDisplay(
                              networkAddress,
                              cidr
                            )}
                        </div>
                        <div class="ip-display">
                            ã‚µãƒ–ãƒãƒƒãƒˆãƒã‚¹ã‚¯: ${generateDecimalDisplay(
                              subnetMask,
                              cidr
                            )}
                        </div>
                    </div>

                    <div class="result-box">
                        <div class="result-title">ğŸ’» 2é€²æ•°è¡¨ç¤ºï¼ˆ32ãƒ“ãƒƒãƒˆï¼‰</div>
                        <div class="binary-display">
                            <div style="margin-bottom: 10px;">
                                <strong>å…¥åŠ›IP:</strong><br>
                                ${generateBinaryDisplay(ip, cidr)}
                            </div>
                            <div style="margin-bottom: 10px;">
                                <strong>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹:</strong><br>
                                ${generateBinaryDisplay(networkAddress, cidr)}
                            </div>
                            <div style="margin-bottom: 10px;">
                                <strong>ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹:</strong><br>
                                ${generateBinaryDisplay(broadcastAddress, cidr)}
                            </div>
                            <div>
                                <strong>ã‚µãƒ–ãƒãƒƒãƒˆãƒã‚¹ã‚¯:</strong><br>
                                ${generateBinaryDisplay(subnetMask, cidr)}
                            </div>
                        </div>
                        <div style="margin-top: 10px; padding: 10px; background: white; border-radius: 5px; font-size: 14px;">
                            <strong>ãƒ“ãƒƒãƒˆæ•°:</strong> 
                            <span class="network-part" style="margin-left: 10px;">ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éƒ¨: ${cidr} ãƒ“ãƒƒãƒˆ</span>
                            <span class="host-part" style="margin-left: 10px;">ãƒ›ã‚¹ãƒˆéƒ¨: ${
                              32 - cidr
                            } ãƒ“ãƒƒãƒˆ</span>
                        </div>
                    </div>
                `;
        } catch (error) {
          resultSection.innerHTML = `
                    <div class="error">
                        âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}
                    </div>
                `;
        }
      }

      // æœ€åˆã®ãƒ›ã‚¹ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨ˆç®—
      function calculateFirstHost(networkAddress) {
        const octets = networkAddress.split(".").map((x) => parseInt(x));
        octets[3] += 1;

        // ã‚­ãƒ£ãƒªãƒ¼ã‚ªãƒ¼ãƒãƒ¼å‡¦ç†
        for (let i = 3; i > 0; i--) {
          if (octets[i] > 255) {
            octets[i] = 0;
            octets[i - 1] += 1;
          }
        }

        return octets.join(".");
      }

      // æœ€å¾Œã®ãƒ›ã‚¹ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨ˆç®—
      function calculateLastHost(broadcastAddress) {
        const octets = broadcastAddress.split(".").map((x) => parseInt(x));
        octets[3] -= 1;

        // ãƒœãƒ­ãƒ¼ã‚¤ãƒ³ã‚°å‡¦ç†
        for (let i = 3; i > 0; i--) {
          if (octets[i] < 0) {
            octets[i] = 255;
            octets[i - 1] -= 1;
          }
        }

        return octets.join(".");
      }

      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
      const input = document.getElementById("cidrInput");

      input.addEventListener("input", (e) => {
        displayResults(e.target.value);
      });

      // åˆæœŸè¡¨ç¤º
      displayResults(input.value);
    </script>
  </body>
</html>
